﻿<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Script-G - Productos</title>
    <link rel="icon" href="../imgs/favicon.svg?v=1" type="image/svg+xml" sizes="any">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/productosStyle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="../css/chatbot.css">
    
    <style>
        /* Estilos adicionales para el modal de detalles */
        .quantity-selector {
            display: flex;
            align-items: center;
            margin: 15px 0;
            gap: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border: 1px solid #ddd;
            background: #f5f5f5;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .quantity-input {
            width: 60px;
            height: 35px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .x-thumbs {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .x-thumb {
            width: 60px;
            height: 60px;
            border: 2px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            overflow: hidden;
        }

        .x-thumb.active {
            border-color: #4a90e2;
        }

        .x-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .btn-favorite.active {
            background-color: #ff6b6b;
            color: white;
        }

        .en-stock {
            background-color: #d4edda;
            color: #155724;
        }

        .sin-stock {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Toast messages */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }
    </style>
</head>

<body>
    <!-- Carrito -->
    <div id="cart" class="ts-cart">
        <a href="#" class="ts-cart__overlay" aria-hidden="true"></a>
        <aside class="ts-cart__panel" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
            <header class="ts-cart__header">
                <div>
                    <h4 id="cartTitle">Carrito de Compras</h4>
                    <small class="ts-cart__count">0 productos</small>
                </div>
                <a href="#" class="ts-x" aria-label="Cerrar">✕</a>
            </header>
            <div class="ts-cart__body">
                <!-- El contenido del carrito se generará dinámicamente aquí -->
            </div>
            <footer class="ts-cart__footer">
                <div class="ts-summary">
                    <div class="ts-summary__row">
                        <span>Subtotal (0 items)</span>
                        <strong>$0</strong>
                    </div>
                    <div class="ts-summary__row">
                        <span>Envío</span>
                        <strong>Gratis</strong>
                    </div>
                    <div class="ts-summary__total">
                        <span>Total</span>
                        <strong class="ts-total-price">$0</strong>
                    </div>
                </div>
                <a href="#" class="ts-pay">
                    <span class="ts-pay__icon"><i class="fa-regular fa-credit-card"></i></span>
                    Pagar Ahora
                </a>
            </footer>
        </aside>
    </div>

    <!-- Header -->
    <header class="main-header">
        <a href="index.html" class="header-logo-title">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M3 4h18a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1h-7v2h3v2H8v-2h3v-2H3a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1Zm1 2v9h16V6H4Z" />
                </svg>
            </div>
            <h1>Script-G</h1>
        </a>

        <div class="busqueda">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="search" placeholder="Buscar componentes...">
        </div>
        <div class="busqueda-resultados" id="searchResults" style="display: none;">
            <div class="resultados-container">
                <!-- Los resultados se cargarán aquí dinámicamente -->
            </div>
        </div>
        <div class="menu">
            <nav>
                <ul class="main-nav-list">
                    <li><a href="../html/index.html" class="menu-btn"><i class="fa-solid fa-house"></i> Inicio</a></li>
                    <li><a href="../html/productos.html" class="menu-btn"><i class="fa-solid fa-box"></i> Productos</a></li>
                    <li>
                        <button class="menu-btn" id="btn-login" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="17" fill="currentColor"
                                class="bi bi-person-fill" viewBox="0 0 16 16">
                                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                            </svg>Log in
                        </button>
                    </li>
                    <li>
                        <a href="#cart" class="menu-btn" id="header-cart-button">
                            <i class="fa-solid fa-cart-shopping"></i>
                            Carrito
                            <span id="cart-count" class="cart-notification"></span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <div class="fix"></div>

    <!-- Modales de Login/Registro -->
    <div class="pop-up modal-cerrado" id="loginModal">
        <div class="card2">
            <form class="form">
                <button type="button" class="cerrar-modal">×</button>
                <p id="heading" class="modal-heading">Iniciar Sesión</p>
                <div class="field">
                    <svg viewBox="0 0 16 16" fill="currentColor" height="16" width="16" xmlns="http://www.w3.org/2000/svg"
                        class="input-icon">
                        <path
                            d="M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z">
                        </path>
                    </svg>
                    <input type="email" class="input-field" placeholder="Correo Electrónico" autocomplete="email">
                </div>
                <div class="field">
                    <svg viewBox="0 0 16 16" fill="currentColor" height="16" width="16" xmlns="http://www.w3.org/2000/svg"
                        class="input-icon">
                        <path
                            d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z">
                        </path>
                    </svg>
                    <input type="password" class="input-field" placeholder="Contraseña">
                </div>
                <div class="btn-is">
                    <button class="button1">Ingresar</button>
                    <button class="button2">Registrarse</button>
                </div>
                <button class="button3">¿Olvidaste tu contraseña?</button>
            </form>
        </div>
    </div>

    <div class="pop-up modal-cerrado" id="signupModal">
        <div class="card2">
            <form class="form signup">
                <button type="button" class="cerrar-modal">×</button>
                <p id="heading">Registrarse</p>
                <div class="name-fields">
                    <div class="field">
                        <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                        </svg>
                        <input type="text" class="input-field" placeholder="Nombre" required/>
                    </div>
                    <div class="field">
                        <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                        </svg>
                        <input type="text" class="input-field" placeholder="Apellido" required/>
                    </div>
                </div>
                <div class="field">
                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558L0 4.697zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"/>
                    </svg>
                    <input type="email" class="input-field" placeholder="Email" required/>
                </div>
                <div class="field">
                    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
                    </svg>
                    <input type="password" class="input-field" placeholder="Contraseña" required/>
                </div>
                <div class="btn-is">
                    <button type="submit" class="button1">Registrarse</button>
                </div>
                <div class="modal-switch">
                    ¿Ya tienes una cuenta? 
                    <button type="button" class="modal-toggle-btn" id="switchToLogin">Iniciar Sesión</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="contenedor">
        <div class="Categorias-container">
            <div class="Categorias">
                <h3>Categorias</h3>
                <p>Explora por tipo de componente</p>
                <button>🎮 Todos los productos</button>
            </div>
            <div class="Categorias-Lista">
                <nav>
                    <ul>
                        <li><a href="#Procesadores">Procesadores</a></li>
                        <li><a href="#TarjetasGraficas">Tarjetas Graficas</a></li>
                        <li><a href="#PlacasMadre">Placas Madre</a></li>
                        <li><a href="#MemoriasRAM">Memorias RAM</a></li>
                        <li><a href="#Almacenamiento">Almacenamiento</a></li>
                        <li><a href="#FuentesPoder">Fuentes de Poder</a></li>
                        <li><a href="#Gabinetes">Gabinetes</a></li>
                        <li><a href="#Refrigeracion">Refrigeracion</a></li>
                        <li><a href="#Perifericos">Perifericos</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        
        <div class="Catalogo-Container">
            <div class="Catalogo-Header">
                <div class="Catalogo-texto">
                    <h2>Catalogo de Productos</h2>
                </div>
                <select id="sort-options">
                    <option value="default">Ordenar por</option>
                    <option value="price-asc">Precio: Bajo a Alto</option>
                    <option value="price-desc">Precio: Alto a Bajo</option>
                    <option value="rating-asc">Calificación: Baja a Alta</option>
                    <option value="rating-desc">Calificación: Alta a Baja</option>
                </select>
            </div>

            <div class="Catalogo" id="catalogo-productos">
                <!-- Los productos se cargarán aquí dinámicamente desde el script -->
            </div>
        </div>
    </div>

       <footer>
="currentColor" viewBox="0 0 24 24">
                    <path d="M3 4h18a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1h-7v2h3v2H8v-2h3v-2H3a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1Zm1 2v9h16V6H4Z" />
                </svg>
                <h1>Script-G</h1>
            </a>
            <div class="Redes_Sociales">
                <h2>Redes Sociales</h2>
                <div class="listas-redes">
                    <ul>
                        <li><a href="#instagram"><i class="fa-brands fa-instagram"></i>Instagram</a></li>
                        <li><a href="#facebook"><i class="fa-brands fa-facebook"></i>Facebook</a></li>
                    </ul>
                    <ul>
                        <li><a href="#youtube"><i class="fa-brands fa-youtube"></i>YouTube</a></li>
                        <li><a href="#tiktok"><i class="fa-brands fa-tiktok"></i>TikTok</a></li>
                    </ul>
                </div>
            </div>
            <h2><a href="Terminos_condiciones">Terminos y Condiciones</a></h2>
        </div>
    </footer>

    <!-- Chatbot -->
    <div id="chatbot-bubble">
        <div class="chat-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div id="chatbot-window">
        <div class="chatbot-header">
            <span>Ayudante SCRIPT-G</span>
            <button id="new-chat-btn">➕ Nuevo Chat</button>
        </div>
        <div class="chatbot-body">
            <div class="chatbot-sidebar" id="chat-sidebar"></div>
            <div class="chatbot-main">
                <div class="chatbot-messages" id="chatbot-messages"></div>
                <div class="chatbot-input">
                    <input type="text" id="chatbot-text" placeholder="Escribí un mensaje..." />
                    <button id="chatbot-send">Enviar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script type='module' src='../scriptsFolder/auth.js'></script>
    <script type="module" src="../scriptsFolder/modalHandler.js"></script>
    <script type="module" src="../scriptsFolder/funciones.js"></script>
    <script type="module" src="../scriptsFolder/busqueda.js"></script>
    
    <script type="module">
        import { obtenerProductos } from '../scriptsFolder/api/api_productos.js';
        import { agregarFavorito } from '../scriptsFolder/api/api_favoritos.js';
        import { agregarAlCarrito, renderizarCarrito, toggleCart, updateCartCount } from '../scriptsFolder/funciones.js';
        import { toggleLoginModal } from '../scriptsFolder/modalHandler.js';
        import { buscarProductos } from '../scriptsFolder/api/api_busqueda.js';
        import { mostrarDetallesProducto } from '../scriptsFolder/detallesProducto.js';

        document.addEventListener('DOMContentLoaded', async () => {
            const contenedor = document.getElementById('catalogo-productos');
            const urlParams = new URLSearchParams(window.location.search);
            const busquedaParam = urlParams.get('busqueda');
            
            let allProducts = [];

            // Adjuntar event listener para el botón del carrito en el header
            const headerCartButton = document.getElementById('header-cart-button');
            if (headerCartButton) {
                headerCartButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleCart();
                });
            }

            // Adjuntar event listener para el botón de login en el header
            const headerLoginButton = document.getElementById('btn-login');
            if (headerLoginButton) {
                headerLoginButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleLoginModal();
                });
            }

            try {
                // Verificar si hay parámetro de búsqueda en la URL
                if (busquedaParam) {
                    document.querySelector('.Catalogo-Header h2').textContent = `Resultados para: "${busquedaParam}"`;
                    allProducts = await buscarProductos(busquedaParam);
                } else {
                    allProducts = await obtenerProductos();
                }

                if (!allProducts || allProducts.length === 0) {
                    contenedor.innerHTML = '<p>No hay productos disponibles.</p>';
                    return;
                }

                contenedor.innerHTML = '';

                allProducts.forEach((p) => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    card.dataset.id = `producto-${p.id}`;
                    
                    card.innerHTML = `
                        <img class="Imagen_Producto"
                            src="${p.imagenes?.[0]?.url || 'https://via.placeholder.com/200'}"
                            alt="${p.nombre}">
                        <div class="content">
                            <span class="stock">${p.stock > 0 ? '🟢 En stock' : '🔴 Agotado'}</span>
                            <h3 class="Titulo">${p.nombre}</h3>
                            <div class="rating">★5/5</div>
                            <p class="Precio">$${p.precio.toLocaleString('es-AR')}</p>
                            <ul class="Especificaciones"></ul>
                            <div class="actions">
                                <button class="btn-cart" data-product-id="${p.id}">Agregar al Carrito</button>
                                <button class="btn-favorite" type="button" data-product-id="${p.id}">Agregar a Favoritos</button>
                                <button class="btn-details" data-product-id="${p.id}">Ver Detalles</button>
                            </div>
                        </div>
                    `;
                    
                    // Event listener para favoritos
                    const favoriteButton = card.querySelector('.btn-favorite');
                    if (favoriteButton) {
                        favoriteButton.addEventListener('click', async (event) => {
                            const productId = event.target.dataset.productId;
                            try {
                                await agregarFavorito(productId);
                                alert('Producto agregado a favoritos con éxito!');
                            } catch (error) {
                                alert('Error al agregar a favoritos: ' + (error.message || 'Por favor, inicia sesión.'));
                            }
                        });
                    }

                    // Event listener para ver detalles
                    const detailsButton = card.querySelector('.btn-details');
                    if (detailsButton) {
                        detailsButton.addEventListener('click', (event) => {
                            const productId = event.target.dataset.productId;
                            mostrarDetallesProducto(productId);
                        });
                    }

                    contenedor.appendChild(card);
                });

                // Delegación de eventos para carrito
                contenedor.addEventListener('click', (event) => {
                    const addToCartButton = event.target.closest('.btn-cart');
                    if (addToCartButton) {
                        const productId = addToCartButton.dataset.productId;
                        const productToAdd = allProducts.find(p => String(p.id) === productId);
                        if (productToAdd) {
                            agregarAlCarrito(event, productToAdd);
                        } else {
                            console.error('Producto no encontrado para el ID:', productId);
                        }
                    }
                });

            } catch (error) {
                console.error('Error al obtener productos:', error);
                contenedor.innerHTML = '<p>Error al cargar los productos.</p>';
            }

            // Inicializar el carrito al cargar la página
            renderizarCarrito();
        });
    </script>
    <script src="../scriptsFolder/chatbot.js"></script>
</body>
</html>